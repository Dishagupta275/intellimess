<!doctype html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Admin Dashboard ‚Äì IntelliMess</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}"/>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <style>
    .action-card.ac-orange i { color:#FF9800; }
    .action-card.ac-blue   i { color:#1976d2; }
    .action-card.ac-purple i { color:#9c27b0; }
    .action-card.ac-teal   i { color:#00897b; }
    .action-card.ac-red    i { color:#e53935; }
    .action-card.ac-indigo i { color:#5c6bc0; }
    .action-card.ac-pdf    i { color:#e53935; }
    .stats-strip { display:grid; grid-template-columns:repeat(auto-fit,minmax(150px,1fr)); gap:16px; margin-bottom:28px; }
    .stat-pill { background:#fff; border-radius:16px; padding:22px 16px; text-align:center; box-shadow:var(--shadow); transition:var(--transition); }
    .stat-pill:hover { transform:translateY(-3px); box-shadow:var(--shadow-hover); }
    .stat-pill .val { font-size:28px; font-weight:700; }
    .stat-pill .lbl { font-size:12px; color:#888; margin-top:4px; }
    .next-meal-panel { background:linear-gradient(135deg,#4CAF50,#81C784); border-radius:18px; padding:24px 28px; color:#fff; margin-bottom:28px; }
    .next-meal-panel h3 { font-size:20px; font-weight:700; margin-bottom:4px; }
    .next-meal-panel .sub { font-size:13px; opacity:.85; margin-bottom:16px; }
    .meal-chips { display:flex; gap:12px; flex-wrap:wrap; }
    .meal-chip { background:rgba(255,255,255,.22); border-radius:12px; padding:10px 20px; text-align:center; }
    .meal-chip .v { font-size:20px; font-weight:700; }
    .meal-chip .l { font-size:11px; opacity:.85; }

    /* Engagement panel */
    .engagement-panel { background:#fff; border-radius:18px; padding:24px 28px;
                        box-shadow:var(--shadow); margin-bottom:28px; }
    .engagement-panel h3 { font-size:16px; font-weight:700; color:#333; margin-bottom:16px;
                           padding-bottom:10px; border-bottom:2px solid #f0f0f0;
                           display:flex; align-items:center; gap:8px; }
    .eng-grid { display:grid; grid-template-columns:repeat(auto-fit,minmax(130px,1fr)); gap:14px; margin-bottom:18px; }
    .eng-stat { background:#f8f9fa; border-radius:12px; padding:14px 16px; text-align:center; }
    .eng-stat .ev { font-size:24px; font-weight:800; }
    .eng-stat .el { font-size:11px; color:#888; margin-top:3px; }
    .streak-list { display:flex; flex-direction:column; gap:8px; }
    .streak-row { display:flex; align-items:center; gap:12px; padding:9px 14px;
                  background:#fff9e6; border-radius:10px; border-left:3px solid #ffd600; }
    .streak-row .name { font-size:13px; font-weight:700; color:#333; flex:1; }
    .streak-row .fire { font-size:13px; color:#e65100; font-weight:700; }
    .streak-row .cnt  { font-size:11px; color:#888; }
    .top-badges { display:flex; gap:10px; flex-wrap:wrap; margin-top:12px; }
    .top-badge-pill { background:#f3f4f6; border-radius:20px; padding:5px 14px;
                      font-size:12px; font-weight:600; color:#555; display:flex; align-items:center; gap:5px; }
  </style>
</head>
<body>
<div class="dashboard-wrapper">
  <nav class="navbar">
    <a href="/admin" class="navbar-brand"><i class="fas fa-utensils"></i><span>IntelliMess</span></a>
    <div class="nav-links">
      <a href="/admin/menu"><i class="fas fa-calendar-week"></i> Menu</a>
      <a href="/admin/polls"><i class="fas fa-poll"></i> Polls</a>
      <a href="/admin/report"><i class="fas fa-file-pdf"></i> Report</a>
      <a href="/logout"><i class="fas fa-sign-out-alt"></i> Logout</a>
    </div>
  </nav>

  <div class="dashboard-container">
    <div class="welcome-card">
      <h2>üëã Welcome, <span style="color:var(--primary-color)">Admin</span>!</h2>
      <p>Manage menus, polls, view analytics and download reports ‚Äî all from one place.</p>
    </div>

    <!-- STAT STRIP -->
    <div class="stats-strip">
      <div class="stat-pill">
        <div class="val" style="color:#4CAF50;">{{ next_meal_count }}</div>
        <div class="lbl">Next Meal (w/ guests)</div>
      </div>
      <div class="stat-pill">
        <div class="val" style="color:#FF9800;">{{ bookings_total }}</div>
        <div class="lbl">Total Bookings</div>
      </div>
      <div class="stat-pill">
        <div class="val" style="color:#9c27b0;">{{ overall_avg if overall_avg else '‚Äî' }}</div>
        <div class="lbl">Avg Rating / 5</div>
      </div>
      <div class="stat-pill">
        <div class="val" style="color:#1976d2;">{{ feedback_rate }}%</div>
        <div class="lbl">Feedback Rate</div>
      </div>
      <div class="stat-pill">
        <div class="val" style="color:#5c6bc0;">{{ open_polls_count }}</div>
        <div class="lbl">Active Polls</div>
      </div>
    </div>

    <!-- NEXT MEAL PANEL -->
    <div class="next-meal-panel">
      <h3><i class="fas fa-clock"></i> Next: {{ next_meal }}</h3>
      <div class="sub">{{ next_meal_date }}</div>
      <div class="meal-chips">
        <div class="meal-chip"><div class="v">{{ next_meal_count }}</div><div class="l">Total Meals</div></div>
        <div class="meal-chip"><div class="v">{{ student_count }}</div><div class="l">Students</div></div>
        <div class="meal-chip"><div class="v">{{ total_guests }}</div><div class="l">Guests</div></div>
        <div class="meal-chip" style="background:rgba(200,255,200,.3)"><div class="v">{{ veg_count }}</div><div class="l">üåø Veg</div></div>
        <div class="meal-chip" style="background:rgba(255,200,200,.3)"><div class="v">{{ nonveg_count }}</div><div class="l">üçó Non-Veg</div></div>
      </div>
    </div>

    <!-- ENGAGEMENT PANEL -->
    <div class="engagement-panel">
      <h3><i class="fas fa-fire" style="color:#ff6f00;"></i> Student Engagement</h3>
      <div class="eng-grid">
        <div class="eng-stat">
          <div class="ev" style="color:#ff6f00;">{{ active_streaks }}</div>
          <div class="el">üî• Active Streaks</div>
        </div>
        <div class="eng-stat">
          <div class="ev" style="color:#f9a825;">{{ total_badges_awarded }}</div>
          <div class="el">üèÖ Badges Awarded</div>
        </div>
        <div class="eng-stat">
          <div class="ev" style="color:#4CAF50;">{{ feedback_rate }}%</div>
          <div class="el">üìù Feedback Rate</div>
        </div>
      </div>

      {% if top_streaks %}
      <div style="font-size:12px;font-weight:700;color:#888;margin-bottom:8px;text-transform:uppercase;letter-spacing:.5px;">üèÜ Top Streaks</div>
      <div class="streak-list">
        {% for s in top_streaks %}
        <div class="streak-row">
          <span style="font-size:18px;">{% if loop.index==1 %}ü•á{% elif loop.index==2 %}ü•à{% elif loop.index==3 %}ü•â{% else %}üî•{% endif %}</span>
          <span class="name">{{ s.username }}</span>
          <span class="fire">üî• {{ s.current_streak }} days</span>
          <span class="cnt">{{ s.total_feedbacks }} feedbacks ¬∑ {{ s.badges }} badges</span>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p style="color:#bbb;font-size:13px;text-align:center;padding:16px 0;">No streaks yet ‚Äî students need to submit feedback!</p>
      {% endif %}

      {% if top_badges %}
      <div style="font-size:12px;font-weight:700;color:#888;margin:14px 0 8px;text-transform:uppercase;letter-spacing:.5px;">Most Earned Badges</div>
      <div class="top-badges">
        {% for b in top_badges %}
        <div class="top-badge-pill">{{ b.icon }} {{ b.key }} <span style="color:#4CAF50;font-weight:800;">√ó{{ b.cnt }}</span></div>
        {% endfor %}
      </div>
      {% endif %}
    </div>

    <!-- COMEBACK SUGGESTIONS -->
    {% if comeback_dishes %}
    <div style="background:#fff;border-radius:18px;padding:22px 28px;
                box-shadow:var(--shadow);margin-bottom:28px;">
      <div style="font-size:16px;font-weight:700;color:#333;margin-bottom:14px;
                  padding-bottom:10px;border-bottom:2px solid #f0f0f0;
                  display:flex;align-items:center;justify-content:space-between;">
        <span>üîÅ Bring These Back!</span>
        <a href="/admin/menu" style="font-size:12px;font-weight:600;color:#4CAF50;text-decoration:none;">
          Add to menu ‚Üí
        </a>
      </div>
      <p style="font-size:12px;color:#aaa;margin:0 0 14px;">
        High-rated dishes (‚≠ê4.0+) not served in the last 14 days ‚Äî students loved these!
      </p>
      {% for dish in comeback_dishes %}
      <div style="display:flex;align-items:center;justify-content:space-between;
                  padding:11px 14px;border-radius:12px;margin-bottom:8px;
                  background:linear-gradient(135deg,#fffde7,#fff8e1);
                  border-left:4px solid #ffd600;">
        <div style="display:flex;align-items:center;gap:12px;">
          <span style="font-size:20px;">üçΩÔ∏è</span>
          <div>
            <div style="font-size:14px;font-weight:700;color:#333;">{{ dish.dish_name }}</div>
            <div style="font-size:11px;color:#888;">
              Last served {{ dish.days_ago }} days ago
              ¬∑ {{ dish.last_served.strftime('%d %b') if dish.last_served else '' }}
            </div>
          </div>
        </div>
        <div style="display:flex;align-items:center;gap:10px;">
          <span style="font-size:13px;font-weight:700;color:#f9a825;">
            ‚≠ê {{ dish.avg_rating }}/5
          </span>
          <a href="/admin/menu?dish={{ dish.dish_name|urlencode }}"
             style="background:#4CAF50;color:#fff;font-size:11px;font-weight:700;
                    padding:4px 12px;border-radius:20px;text-decoration:none;">
            Add to menu
          </a>
        </div>
      </div>
      {% endfor %}
    </div>
    {% endif %}

    <!-- QUICK ACTION CARDS -->
    <div class="dashboard-links">
      <a href="/admin/menu" class="action-card">
        <i class="fas fa-calendar-week" style="color:#4CAF50;"></i>
        <h3>Weekly Menu</h3>
        <p>Add or remove dishes from the menu</p>
      </a>
      <a href="/admin/polls" class="action-card">
        <i class="fas fa-poll" style="color:#1976d2;"></i>
        <h3>Polls</h3>
        <p>Create polls and view results</p>
      </a>
      <a href="/admin/analytics" class="action-card">
        <i class="fas fa-chart-bar" style="color:#FF9800;"></i>
        <h3>Analytics</h3>
        <p>Charts, trends and ratings</p>
      </a>
      <a href="/admin/sentiment" class="action-card">
        <i class="fas fa-brain" style="color:#9c27b0;"></i>
        <h3>Sentiment</h3>
        <p>Comment analysis per dish</p>
      </a>
      <a href="/admin/heatmap" class="action-card">
        <i class="fas fa-th" style="color:#00897b;"></i>
        <h3>Heatmap</h3>
        <p>Booking patterns &amp; dish comebacks</p>
      </a>
      <a href="/admin/bookings" class="action-card">
        <i class="fas fa-list" style="color:#5c6bc0;"></i>
        <h3>All Bookings</h3>
        <p>View every booking record</p>
      </a>
      <a href="/admin/report" class="action-card">
        <i class="fas fa-file-pdf" style="color:#e53935;"></i>
        <h3>Weekly Report</h3>
        <p>Download full PDF report</p>
      </a>
      <a href="/admin/suggestions" class="action-card">
        <i class="fas fa-lightbulb" style="color:#f59e0b;"></i>
        <h3>Dish Suggestions</h3>
        <p>See what students want to eat</p>
      </a>
      <a href="/admin/forecast" class="action-card">
        <i class="fas fa-brain" style="color:#1976d2;"></i>
        <h3>Demand Forecast</h3>
        <p>Predict headcount for upcoming meals</p>
      </a>
      <a href="/logout" class="action-card">
        <i class="fas fa-sign-out-alt" style="color:#f44336;"></i>
        <h3>Logout</h3>
        <p>Sign out of admin account</p>
      </a>
    </div>
  </div>
</div>
</body>
</html>
