<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meal Feedback - IntelliMess</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>

<body>
<div class="dashboard-wrapper">

    <div class="feedback-container">
        <div class="feedback-card">
            <h2><i class="fas fa-comment-dots"></i> Give Feedback</h2>

            {% if feedback_data %}
                {% for item in feedback_data %}

                <div class="feedback-meal-header">
                    <i class="fas fa-utensils"></i>
                    <h3>{{ item.meal }}</h3>
                </div>

                <form method="POST" action="/submit_feedback">
                    <input type="hidden" name="booking_id" value="{{ item.booking_id }}">

                    {% for dish in item.dishes %}
                    <div class="dish-feedback-item">

                        <h4>{{ dish.dish_name }}</h4>

                        <!-- Consumption Checkbox -->
                        <label>
                            <input type="checkbox"
                                   name="consumed_{{ dish.id }}"
                                   onclick="toggleRating({{ dish.id }})">
                            I consumed this dish
                        </label>

                        <!-- Rating Section -->
                        <div id="rating_section_{{ dish.id }}" style="display:none; margin-top:10px;">

                            <select name="rating_{{ dish.id }}">
                                <option value="">Select Rating</option>
                                <option value="5">5 - Excellent</option>
                                <option value="4">4 - Very Good</option>
                                <option value="3">3 - Average</option>
                                <option value="2">2 - Poor</option>
                                <option value="1">1 - Very Poor</option>
                            </select>

                            <br><br>

                            <textarea name="comment_{{ dish.id }}"
                                      rows="2"
                                      placeholder="Optional comment"></textarea>
                        </div>

                    </div>
                    {% endfor %}

                    <button type="submit" class="feedback-submit-btn">
                        Submit Feedback
                    </button>
                </form>

                <hr>

                {% endfor %}
            {% else %}
                <p>No completed meals available for feedback.</p>
            {% endif %}

        </div>
    </div>

</div>

<script>
function toggleRating(id) {
    const section = document.getElementById("rating_section_" + id);
    section.style.display =
        section.style.display === "none" ? "block" : "none";
}
</script>

</body>
</html>